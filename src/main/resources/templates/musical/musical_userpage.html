<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>

<head>
    <meta charset="UTF-8">
    <title>마이페이지</title>
    <style>
        .mypage_wrap{ display: block;}
        .title_sub_area { display: flex; justify-content: space-between; align-items: center; }
        .title_area { display: flex; align-items: center; font-size: 26px;}
        .title { margin-right: 10px; }
        .sub {margin-left: 18px; font-size: 22px;}
        .sub em {font-style: normal; color:red; text-decoration: underline;}

        p, ul {margin:0; padding:0;}

        /* 세션 스타일 -> 전체 범위 조절 */
        #section{
           width: 50%; /* 너비 */
           margin-left: auto; /* 가운데 정렬 */
           margin-right: auto; /* 가운데 정렬 */
        }

        /* 뮤지컬 사진 스타일 */
        .poster { float: left; margin-right: 10px; }

        /* 뮤지컬 아이템 스타일 */
        .my_movie_list{
            display: flex; /* flex 설정 */
            flex-wrap: wrap; /* 아이템 1:1 비율로 배치하고 나머지는 내리기 위해서 */
            list-style: none;
            align-item : center;
            justify-content: center;
            list-style: none;
        }
        .my_movie_list li {
            flex: 1 1 50%; /* 각 li 요소의 너비를 50%로 설정 */
            box-sizing: border-box; /* 패딩과 테두리를 포함한 박스 크기 계산 */
            margin-bottom: 30px; /* li 요소 간의 간격 */
            padding: 10px;
            display: block;
            width: 480px;

        }

        .detail_info{
            margin-top : 10px; /* 제목과 아이템 간격 */
        }

        /* 삭제 버튼 */
        .btn_box{
            float : right;
        }




    </style>
</head>

<body>
    <div id="section">
        <div class="mypage_wrap">
            <div class="title_sub_area">
                <div class="title_area">
                    <h4 class="title" style="font-style:normal; font-weight:normal;" >예약한 뮤지컬 : </h4>
                    <span class="sub"><em th:text="${count}"> </em> 편</span>
                </div>
            </div>
        </div>
        <div>
        <ul class="my_movie_list">
            <li th:each="musical : ${list}" style="display : block;">
                <div class="poster">
                    <a href="#none" title="뮤지컬 상세페이지 이동">
                        <img src="/upload/mypage.jpg" style="width: 200px; height: auto;">
                    </a>
                </div>
                <strong class="tit" style="cursor:pointer;">
                    <span th:text="${musical.title}" style="font-size: 21px;"></span>
                </strong>
                <div class="detail_info">
                    <p th:text="${musical.place}">장소</p>
                    <p id="date" th:text="${musical.date}">날짜</p>
                    <p th:text="'관람인원 ' +${#lists.size(musical.seat_list)} + '명'" style="margin-top:6px;"></p>
                    <p th:text="${musical.seat_list}">관람 좌석</p>
                    <p id="resno" th:text="${musical.res_no}" style="display:none;">번호</p>
                </div>
                <div class="btn_box">
                    <button id="del" type="button" onclick="del()" class="btn_del">삭제</button>
                </div>
            </li>
        </ul>
        </div>
    </div>

</body>

<script>



    function del(){
        let date = document.querySelector('#date').textContent.trim();;
        let resno = document.querySelector('#resno').textContent.trim();;

        $.ajax({
        type: "POST",
        url: "/musical/delete",
        data: { res_no : resno, date : date},
        success: function(response) {
            alert("성공");
            alert(date);
            alert(resno);
        },
        error: function(xhr, status, error) {
            alert("실패");
       }
       });
    }

</script>
</html>